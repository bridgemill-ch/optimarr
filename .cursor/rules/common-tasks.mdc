---
type: Apply Intelligently
description: Common development tasks and workflows for adding features, endpoints, services, and database changes
---

# Common Tasks

## Adding a New Feature

1. **Plan:**
   - Check if it's in `docs/PRD.md`
   - Determine database impact (see version-management rule)
   - Plan UI changes

2. **Implement:**
   - Create/update models in `Models/` if needed
   - Create service in `Services/` if needed (see code-patterns rule)
   - Add controller endpoints in `Controllers/` (see code-patterns rule)
   - Update frontend JavaScript in `wwwroot/js/`
   - Update UI in `wwwroot/index.html` and `wwwroot/styles.css`

3. **Test:**
   - Test functionality manually
   - Test error cases
   - Test with different data sizes
   - Check browser console for errors

4. **Document:**
   - Update `VERSION` file (increment version)
   - Add entry to `docs/CHANGELOG.md` (see version-management rule)
   - Add entry to `docs/STORY_TRACKING.md` (see version-management rule)
   - Update relevant docs (`docs/PRD.md`, `docs/ARCHITECTURE.md`, `docs/DEVELOPER_GUIDE.md`)
   - Create migration script in `Data/Migrations/` if needed (see version-management rule)

**Example:** See STORY-002 in `docs/STORY_TRACKING.md` for complete feature addition workflow

## Adding a New API Endpoint

1. Add method to appropriate Controller in `Controllers/` directory
2. Use consistent error handling (try-catch with logging)
3. Return appropriate HTTP status codes (200 OK, 400 BadRequest, 500 InternalServerError)
4. Log important operations using structured logging
5. Update API documentation if needed

**Example from `Controllers/ServarrController.cs`:**
```csharp
[HttpPost("match-videos")]
public async Task<ActionResult> MatchVideosWithServarr()
{
    _logger.LogInformation("Video matching with Servarr requested");
    try
    {
        var result = await _matcherService.MatchAllVideosAsync();
        return Ok(new { matched = result });
    }
    catch (Exception ex)
    {
        _logger.LogError(ex, "Error matching videos with Servarr");
        return StatusCode(500, new { error = ex.Message });
    }
}
```

## Adding a New Service

1. Create service class in `Services/` directory
2. Register in `Program.cs` with appropriate lifetime (Scoped, Singleton, Transient)
3. Use constructor injection for dependencies
4. Follow existing service patterns

**Example service registration in `Program.cs`:**
```csharp
builder.Services.AddScoped<VideoServarrMatcherService>();
builder.Services.AddSingleton<VideoMatchingProgressService>();
```

**Reference:** See `Services/VideoServarrMatcherService.cs` for service pattern example

## Modifying Database Schema

1. **CRITICAL:** Create migration script first in `Data/Migrations/`
2. Update model class in `Models/` directory
3. Update `Data/AppDbContext.cs` if needed for relationships or constraints
4. Test migration script on sample database
5. Document in `docs/CHANGELOG.md` and `docs/STORY_TRACKING.md`

**Reference:** See `Data/Migrations/AddServarrFields.sql` for complete migration example

## Database Changes (SQLite Limitations)

- SQLite doesn't support ALTER TABLE for many operations
- Create new table, copy data, drop old table, rename new table
- Migration scripts go in `Data/Migrations/`
- Test migrations before committing

**Pattern:** See version-management rule for complete SQLite migration pattern
