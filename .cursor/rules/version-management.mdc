---
type: Always Apply
description: Version management, story tracking, and database migration guidelines for Optimarr
---

# Version Management & Story Tracking

## Version Numbers
- Follow **Semantic Versioning** (MAJOR.MINOR.PATCH)
- Version is stored in `VERSION` file in project root
- Version is displayed in UI sidebar (loaded from `/api/system/version`)

## Story Tracking Requirements
**EVERY change must be documented:**

1. **Check Database Impact:**
   - If adding/modifying models, create migration script in `Data/Migrations/`
   - Test migration on sample database
   - Migration scripts must handle SQLite limitations (ALTER TABLE is limited)

2. **Update Version:**
   - Increment version in `VERSION` file
   - Add entry to `docs/CHANGELOG.md` with:
     - Version number and date
     - Story ID (STORY-XXX) or "-" for bug fixes
     - Description of changes
     - Database impact (if any)
     - Migration script path (if applicable)
   - Add entry to `docs/STORY_TRACKING.md` with complete details

3. **Update Documentation:**
   - Update `docs/PRD.md` if requirements change
   - Update `docs/ARCHITECTURE.md` if architecture changes
   - Update `docs/DEVELOPER_GUIDE.md` if development process changes
   - Update `README.md` if user-facing features change

## Story Template
```markdown
**STORY-XXX: Story Title**
- **Status:** âœ… Completed / ðŸŸ¡ In Progress / ðŸ”´ Blocked
- **Priority:** High / Medium / Low
- **Version:** X.Y.Z
- **Database Changes:** Yes/No - Details
- **Migration Script:** Path (if applicable)
- **UI Changes:** List of changes
- **API Changes:** List of endpoint changes
- **Files Modified:** List of files
```

## Database Migration Guidelines

### When Schema Changes Are Needed

1. **Create Migration Script:**
   - Location: `Data/Migrations/AddFeatureName.sql`
   - SQLite requires table recreation for most ALTER TABLE operations
   - **Reference:** See `Data/Migrations/AddServarrFields.sql` for complete example

   **Pattern:**
   ```sql
   BEGIN TRANSACTION;
   CREATE TABLE TableName_new (
       -- Include all existing columns plus new ones
       Id INTEGER PRIMARY KEY,
       ExistingColumn TEXT,
       NewColumn TEXT  -- New column added
   );
   INSERT INTO TableName_new (Id, ExistingColumn, NewColumn)
   SELECT Id, ExistingColumn, NULL FROM TableName;
   DROP TABLE TableName;
   ALTER TABLE TableName_new RENAME TO TableName;
   -- Recreate indexes
   CREATE INDEX IF NOT EXISTS idx_table_name_column ON TableName(Column);
   COMMIT;
   ```

2. **Update Model:**
   - Add new properties to model class in `Models/` directory
   - Update `Data/AppDbContext.cs` if needed for relationships or constraints
   - **Example:** See `Models/VideoAnalysis.cs` for model with Servarr fields

3. **Test Migration:**
   - Test on sample database
   - Verify data integrity
   - Check indexes are recreated

4. **Document:**
   - Add to CHANGELOG.md
   - Update README.md with migration instructions
   - Document in STORY_TRACKING.md

### Migration Service
- `DatabaseMigrationService` handles migrations on startup
- Uses `EnsureCreated` as fallback if migrations aren't set up
- Check migration status via `/api/system/migration`
